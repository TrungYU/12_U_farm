<!DOCTYPE html>
<html>
<head>
    <title>U-Farm My Hub</title>
    <link rel="stylesheet" type="text/css" href="css/main_style_sheet.css"/>
    <link rel="stylesheet" type="text/css" href="css/seller_hub_style_sheet.css"/>
    
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDY0u4aTYkbjbu42DnbOtYBBuoD93P516Y",
        authDomain: "u-farm.firebaseapp.com",
        databaseURL: "https://u-farm.firebaseio.com",
        projectId: "u-farm",
        storageBucket: "u-farm.appspot.com",
        messagingSenderId: "166743546426"
    };
    firebase.initializeApp(config);
    </script>
</head>
<body>
    <div class="topbar">

    </div>
    
    <div class="navbar">
        <center>
        <a href="index.html">About</a>
        <a href="#marketplace.html">Market Place</a>
        <a href="#farmers">Farmers</a>
        <a href="Contact_Us.html">Contact Us</a>
        </center>
    </div>
    
    <div class="sidenav">
        <!-- <input type="checkbox" name="" value=""><br> -->
        <ul>
            <li><a class="sideNavHeaders" href="SellerHub.html">Overview</a></li>
            <li><a class="sideNavHeaders" href="#mylistings">My Listings</a>
                <ul>
                    <li><a class="sideNavSubHeaders" id = "newlisting" href="createnewlisting.html">Create New Listing</a></li>
                    <li><a class="sideNavSubHeaders" href="#currentlistings">View Current Listings</a></li>
                </ul>
            </li>
            <li><a class="sideNavHeaders" href="orders.html">Orders</a></li>
            <li><a class="sideNavHeaders" href="#ratings">Ratings</a></li>
            <li><a class="sideNavHeaders" href="#performance">Performance</a></li>
        </ul>
    <!-- https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_input_checked -->
    <!-- Check box and form tutorial -->
        
    </div>
    <div class="bottombar">
        
    </div>

    <div class="main">
        <h1>Create New Listing</h1>
        <p>Please complete the following form to create a new listing</p>
        <hr>

        <div class="product">
            <p><strong>Product</strong>
            <input type="text" placeholder="Enter Product Name" id="product" required></p>
        </div>

        <div class="description">
            <p><strong>Description</strong>
            <textarea placeholder="Description of Product" id="description" rows="10" cols="40"></textarea></p>
        </div>

        <div class="quantity">
            <p><strong>Quantity</strong></p>
            <input type="number" placeholder="0" id="quantity">
            <select name="weight" id="weight">
                <option value="pounds" selected>Pounds</option>
                <option value="ounces">Ounces</option>
                <option value="grams">Grams</option>
                <option value="kilograms">kilograms</option>
            </select>
        </div>

        <div class="photo">
            <label for="photo"><strong>Photos of Product</strong></label>
            <input type="file" value="upload" id="photoupload">
        </div>

        <div>
            <button id ="submit" class="newlistingbutton">Post New Listing</button>
        </div>
    </div>

    <script>
        let number_of_listings;
        let file;

        var db = firebase.database().ref().child("Listings")
        db.on(
            "value",
            function(snap){
                dict_of_listings = snap.val();
                all_listings = Object.keys(dict_of_listings);
                number_of_listings = all_listings.length;
            }
        )

        var photoupload = document.getElementById("photoupload");
        photoupload.addEventListener("change", function(e) {
            file = e.target.files[0];
        })

        function updateDatabase() {
            let key = "Listing" + number_of_listings
            let selection = document.getElementById("weight").value;
            firebase.database().ref("Listings/").update({
                [key]: {
                    Name: document.getElementById("product").value,
                    Description: document.getElementById("description").value,
                    Quantity: document.getElementById("quantity").value,
                    Weight: selection
                }
            })
            var storageRef = firebase.storage().ref("produce_pics/" + file.name);
            storageRef.put(file);
        }



        document.getElementById("newlisting").style.fontWeight = "bold";
        document.getElementById("submit").onclick = updateDatabase;
    </script>

</body>
</html>

