<!DOCTYPE html>
<html>
<head>
    <title>U-Farm List Of Orders</title>
    <link rel="stylesheet" type="text/css" href="css/main_style_sheet.css"/>
    <link rel="stylesheet" href="css/externalstylesheet.css">
    <link rel="stylesheet" type="text/css" href="css/seller_hub_style_sheet.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"> <!--Font-->
    <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase.js"></script>
    <script src =js/setup_firebase.js></script>
    <script>
        let current = [];
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in.
                var displayName = user.displayName;
                var email = user.email;
                var uid = user.uid;
                current.push(displayName);
                current.push(email);
                current.push(uid);
            } else {
                // User is signed out.
                // ...
            }
        });
    </script>
    <style>
        html,body,h1,h2,h3,h4 {font-family:"Lato", sans-serif}
    </style>
</head>
<body>

    <!-- Links (sit on top) -->
    <div class="top" style="position:absolute">
        <div class="row large light-grey">
            <div class="col s3" id="home"><a href="index.html" class="button block">Home</a></div>
            <div class="col s3" id="about"><a href="about.html" class="button block">About</a></div>
            <div class="col s3" id="marketplace"><a href="marketplace.html" class="button block">Marketplace</a></div>
            <div class="col s3" id="farmer"><a href="SellerHub.html" class="button block">Farmers</a></div>
        </div>
    </div>
    
    <div class="sidenav">
        <ul>
            <li><a class="sideNavHeaders" href="SellerHub.html">Overview</a></li>
            <li><a class="sideNavHeaders" href="createnewlisting.html">My Listings</a></li>
            <li><a class="sideNavHeaders" href="#orders">Orders</a>
                <ul>
                    <li><a class="sideNavSubHeaders" id="allorders" href="orders.html">All Orders</a></li>
                    <li><a class="sideNavSubHeaders" id="dailyorders" href="ordersbyday.html">Daily Details</a></li>
                </ul>
            </li>
            <li><a class="sideNavHeaders" href="#ratings">Ratings</a></li>
            <li><a class="sideNavHeaders" href="#performance">Performance</a></li>
        </ul>
    </div>

    <div class="main">
        <h1>Daily Details - <span id="titledate"></span></h1>
        
        <div id="dailyOrderTable">
            <table class="orderTable" id="dailyDetails">
                <tr>
                    <th>Order Month</th>
                    <th>Order Day</th>
                    <th>Order Year</th>
                    <th>Farmer ID</th>
                    <th>Order Number
                        <div class="sortarrows">
                            <div class="uparrow" id="onuarrow" onclick="sortTableAscending(3, id)"></div>
                            <div class="downarrow" id="ondarrow" onclick="sortTableDescending(3, id)"></div>
                        </div>
                    </th>
                    <th>Produce
                        <div class="sortarrows">
                            <div class="uparrow" id="puarrow" onclick="sortTableAscending(4, id)"></div>
                            <div class="downarrow" id="pdarrow" onclick="sortTableDescending(4, id)"></div>
                        </div>
                    </th>
                    <th>Quantity
                        <div class="sortarrows">
                            <div class="uparrow" id="quarrow" onclick="sortTableAscending(5, id)"></div>
                            <div class="downarrow" id="qdarrow" onclick="sortTableDescending(5, id)"></div>
                        </div>
                    </th>
                    <th>Customer Name
                        <div class="sortarrows">
                            <div class="uparrow" id="cnuarrow" onclick="sortTableAscending(6, id)"></div>
                            <div class="downarrow" id="cndarrow" onclick="sortTableDescending(6, id)"></div>
                        </div>
                    </th>
                    <th>Pickup Time
                        <div class="sortarrows">
                            <div class="uparrow" id="ptuarrow" onclick="sortTableAscending(7, id)"></div>
                            <div class="downarrow" id="ptdarrow" onclick="sortTableDescending(7, id)"></div>
                        </div>
                    </th>
                </tr>
            </table> 
        </div>

        <div id="calendardiv">   
            <table id="calendartable">
                <tr id="calendarmonth">
                    <th id="month" colspan="7">
                        <div id="leftarrow"></div>
                        <span id="selectedmonth"></span>
                        <span> </span>
                        <span id="selectedyear"></span>
                        <div id="rightarrow"></div>
                    </th>
                </tr>
                <tr id="calendarday">
                    <td>Sun</td>
                    <td>Mon</td>
                    <td>Tue</td>
                    <td>Wed</td>
                    <td>Thu</td>
                    <td>Fri</td>
                    <td>Sat</td>
                </tr>
            </table>
        </div>
    </div>
        <script>
            let dict_of_months = {0: "January", 1: "February", 2: "March", 3: "April",
                                  4: "May", 5: "June", 6: "July", 7: "August", 8: "September",
                                  9: "October", 10: "November", 11: "December"};
            
            let selecteddate;
            function createCalendar() {
                let week = 1;
                let day = 1;
                for (i = 0; i <= 5; i++) {
                    let tr = document.createElement("tr");
                    tr.id = "week" + week;
                    document.getElementById("calendartable").appendChild(tr);
                    for (j = 0; j <= 6; j++) {
                        let td = document.createElement("td");
                        td.id = "day" + day;
                        document.getElementById("week" + week).appendChild(td);
                        td.style.cursor = "pointer";
                        td.onclick = function() {
                            document.getElementById(selecteddate).style.fontWeight = "normal";
                            current_date = parseInt(td.innerHTML);
                            selecteddate = td.id;
                            document.getElementById(td.id).style.fontWeight = "bold";
                            setMainDate();
                            setCalendarDate();
                            filterTable();
                        }
                        day++;
                    }
                    week++;
                }
            }

            function buildOrderTable() {
                var db = firebase.database().ref().child("Orders")
                db.on(
                    "value",
                    function(snap){
                        dict_of_orders = snap.val();
                        all_orders = Object.keys(dict_of_orders);
                        all_details = Object.values(dict_of_orders);
                        for (let i=0; i<all_orders.length-1;i++) {
                            let tr = document.createElement("tr");
                            tr.id = all_orders[i];
                            document.getElementById('dailyDetails').appendChild(tr);
                            let details = all_details[i];
                            let month = details['Month'] - 1;
                            let full_order = []
                            full_order.push(month);
                            full_order.push(details['Day']);
                            full_order.push(details['Year']);
                            full_order.push(details['FarmerID']);
                            full_order.push(details['Number']);
                            full_order.push(details['Produce']);
                            full_order.push(details['Quantity']);
                            full_order.push(details['CustName']);
                            full_order.push(details['Pickup']);
                            for (let j=0; j<full_order.length; j++) {
                                let td = document.createElement("td");
                                tr.appendChild(td);
                                td.innerHTML = full_order[j];
                            }          
                        }
                        filterTable();
                    }
                )
            }


            function buildCalendar() {
                let earliestdate = current_date%7;
                let earliestday = 8 - earliestdate + current_day;
                let firstday = 1;
                if (earliestday > 6) {
                    earliestday -= 7;
                }
                for (i = 1; i <= days_in_current_month; i++) {
                    document.getElementById("day" + (i + earliestday)).innerHTML = i;
                    document.getElementById("day" + (i + earliestday)).style.color = "black";
                    if (i == current_date) {
                        document.getElementById("day" + (i + earliestday)).style.fontWeight = "bold";
                        selecteddate = document.getElementById("day" + (i + earliestday)).id;
                    }
                }
                for (i = 0; i < earliestday; i++) {
                    document.getElementById("day" + (earliestday - i)).innerHTML = days_in_previous_month - i;
                    document.getElementById("day" + (earliestday - i)).style.color = "lightgray";
                }
                for (i = days_in_current_month + 1; i + earliestday <= 42; i++) {
                    document.getElementById("day" + (i + earliestday)).innerHTML = firstday;
                    document.getElementById("day" + (i + earliestday)).style.color = "lightgray";
                    firstday++;
                }
                if (document.getElementById("day36").style.color == "lightgray") {
                    document.getElementById("week6").style.display = "none";
                }
                else {
                    document.getElementById("week6").style.display = "table-row";
                }

            }

            function leftarrowclick () {
                if (current_month > 0) {
                    current_month -= 1;
                }
                else {
                    current_month = 11;
                    current_year -= 1;
                }
                document.getElementById(selecteddate).style.fontWeight = "normal";
                current_date = 1;
                date = new Date(current_year, current_month, current_date);
                current_day = date.getDay();
                days_in_current_month = new Date(current_year, current_month + 1, 0).getDate();
                days_in_previous_month = new Date(current_year, current_month, 0).getDate();
                buildCalendar();
                setCalendarDate();
            }

            function rightarrowclick () {
                if (current_month < 11) {
                    current_month += 1;
                }
                else {
                    current_month = 0;
                    current_year += 1;
                }
                document.getElementById(selecteddate).style.fontWeight = "normal";
                current_date = 1;
                date = new Date(current_year, current_month, current_date);
                current_day = date.getDay();
                days_in_current_month = new Date(current_year, current_month + 1, 0).getDate();
                days_in_previous_month = new Date(current_year, current_month, 0).getDate();
                buildCalendar();
                setCalendarDate();
            }
            
            function setMainDate () {
                document.getElementById("titledate").innerHTML = dict_of_months[current_month] + " " + current_date.toString() + " " + current_year.toString();
            }
            function setCalendarDate () {
                document.getElementById("selectedmonth").innerHTML = dict_of_months[current_month];
                document.getElementById("selectedyear").innerHTML = current_year;
            }

            function filterTable() {
                table = document.getElementById("dailyDetails");
                row = table.getElementsByTagName("tr");
                for (i = 1; i < row.length; i++) {
                    order = row[i].getElementsByTagName("td");
                    if (order[0].innerHTML == current_month && order[1].innerHTML == current_date && order[2].innerHTML == current_year && order[3].innerHTML == current[2]) {
                        row[i].style.display = "table-row";
                    } 
                    else {
                        row[i].style.display = "none";
                    }
                }
            }

            function sortTableAscending(column, id) {
                table = document.getElementById("dailyDetails");
                rows = table.rows;
                sorting = true;
                while (sorting) {
                    switching = false;
                    for (i = 1; i < rows.length - 1; i++) {
                        if (rows[i].getElementsByTagName("td")[column].innerHTML > rows[i+1].getElementsByTagName("td")[column].innerHTML) {
                            switching = true;
                            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                            break;
                        }
                    }
                    if (switching == false) {
                        sorting = false;
                    }
                }
                document.getElementById(current_sort).style.borderTopColor = "lightgray";
                document.getElementById(current_sort).style.borderBottomColor = "lightgray";
                document.getElementById(id).style.borderBottomColor = "grey";
                current_sort = id;
            }

            function sortTableDescending(column, id) {
                table = document.getElementById("dailyDetails");
                rows = table.rows;
                sorting = true;
                while (sorting) {
                    switching = false;
                    for (i = 1; i < rows.length - 1; i++) {
                        if (rows[i].getElementsByTagName("td")[column].innerHTML < rows[i+1].getElementsByTagName("td")[column].innerHTML) {
                            switching = true;
                            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                            break;
                        }
                    }
                    if (switching == false) {
                        sorting = false;
                    }
                }
                document.getElementById(current_sort).style.borderBottomColor = "lightgray";
                document.getElementById(current_sort).style.borderTopColor = "lightgray";
                document.getElementById(id).style.borderTopColor = "grey";
                current_sort = id;
            }

            document.getElementById("dailyorders").style.fontWeight = "bold";
            document.getElementById("ptuarrow").style.borderBottomColor = "grey";
            let date = new Date();
            let current_month = date.getMonth();
            let current_date = date.getDate();
            let current_year = date.getFullYear();
            let current_day = date.getDay();
            let days_in_current_month = new Date(current_year, current_month + 1, 0).getDate();
            let days_in_previous_month = new Date(current_year, current_month, 0).getDate();
            let current_sort = "ptuarrow";
            buildOrderTable();
            sortTableAscending(7, current_sort);
            createCalendar();
            buildCalendar();
            setMainDate();
            setCalendarDate();

            document.getElementById("leftarrow").onclick = leftarrowclick;
            document.getElementById("rightarrow").onclick = rightarrowclick;

        </script>
    </form>
</body>
</html>

