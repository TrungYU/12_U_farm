<!DOCTYPE html>
<html>
<head>
    <title>U-Farm My Hub</title>
    <link rel="stylesheet" type="text/css" href="css/main_style_sheet.css"/>
    <link rel="stylesheet" type="text/css" href="css/externalstylesheet.css">
    <link rel="stylesheet" type="text/css" href="css/seller_hub_style_sheet.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"> <!--Font-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <!--some buttons-->
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script src="js/setup_firebase.js"></script>
    <style>
        html,body,h1,h2,h3,h4 {font-family:"Lato", sans-serif}
    </style>
</head>
<body>
    <!-- Links (sit on top) -->
    <div class="top" style="position:absolute">
        <div class="row large light-grey">
            <div class="col s3" id="home"><a href="index.html" class="button block">Home</a></div>
            <div class="col s3" id="about"><a href="about.html" class="button block">About</a></div>
            <div class="col s3" id="marketplace"><a href="marketplace.html" class="button block">Marketplace</a></div>
            <div class="col s3" id="farmer"><a href="SellerHub.html" class="button block">Farmers</a></div>
        </div>
    </div>
    <div class="sidenav">
        <!-- <input type="checkbox" name="" value=""><br> -->
        <ul>
            <li><a class="sideNavHeaders" href="SellerHub.html">Overview</a></li>
            <li><a class="sideNavHeaders" href="#mylistings">My Listings</a>
                <ul>
                    <li><a class="sideNavSubHeaders" id = "newlisting" href="createnewlisting.html">Create New Listing</a></li>
                    <li><a class="sideNavSubHeaders" href="#currentlistings">View Current Listings</a></li>
                </ul>
            </li>
            <li><a class="sideNavHeaders" href="orders.html">Orders</a></li>
            <li><a class="sideNavHeaders" href="#ratings">Ratings</a></li>
            <li><a class="sideNavHeaders" href="#performance">Performance</a></li>
        </ul>
        
    </div>


    <div class="main">
        <h1>Create New Listing</h1>
        <p>Please complete the following form to create a new listing</p>
        <hr>

        <div class="product">
            <p><strong>Product</strong>
            <input type="text" placeholder="Enter Product Name" id="product" required></p>
        </div>

        <div class="description">
            <p><strong>Description</strong>
            <textarea placeholder="Description of Product" id="description" rows="10" cols="40"></textarea></p>
        </div>

        <div class="quantity">
            <p><strong>Quantity</strong></p>
            <input type="number" placeholder="0" id="quantity">
            <select name="weight" id="weight">
                <option value="pounds" selected>Pounds</option>
                <option value="ounces">Ounces</option>
                <option value="grams">Grams</option>
                <option value="kilograms">kilograms</option>
            </select>
        </div>

        <div class="photo">
            <label for="photo"><strong>Photos of Product</strong></label>
            <input type="file" value="upload" id="photoupload">
        </div>

        <div>
            <button id ="submit" class="newlistingbutton">Post New Listing</button>
        </div>
    </div>


    <script>
        let number_of_listings;
        let file;
        let current = [];

        let unique;
        var db = firebase.database().ref().child("Listings/UniqueListings");
        db.on(
            "value",
            function(snap){
                unique = snap.val();
            }
        );
        
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in.
                var displayName = user.displayName;
                var email = user.email;
                var uid = user.uid;
                current.push(displayName);
                current.push(email);
                current.push(uid);
            } else {
                // User is signed out.
                // ...
            }
        });

        var photoupload = document.getElementById("photoupload");
        photoupload.addEventListener("change", function(e) {
            file = e.target.files[0];
        });

        // Update to database
        function updateDatabase() {
            console.log(current[0]);
            let key = "Listing" + unique;
            let selection = document.getElementById("weight").value;
            firebase.database().ref("Listings/").update({
                [key]: {
                    Name: document.getElementById("product").value,
                    Farmer: current[0],
                    Description: document.getElementById("description").value,
                    Quantity: document.getElementById("quantity").value,
                    Weight: selection,
                    FarmerID: current[2]
                }
            });
            firebase.database().ref("Listings/").update({
                UniqueListings: unique + 1
            })
            var storageRef = firebase.storage().ref("produce_pics/" + key + "/produce.jpg");
            storageRef.put(file);
            document.getElementById("submit").innerHTML = "Listing Created!";
            document.getElementById("submit").disabled = "true";
            document.getElementById("submit").style.opacity = "1";
        }
        document.getElementById("submit").onclick = updateDatabase;
        document.getElementById("newlisting").style.fontWeight = "bold";
    </script>

</body>
</html>

