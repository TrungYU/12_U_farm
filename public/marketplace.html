<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="css/main_style_sheet.css"/>
    <link rel="stylesheet" type="text/css" href="css/externalstylesheet.css">
    <link rel="stylesheet" type="text/css" href="css/market_place.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"> <!--Font-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <!--some buttons-->
    <title>U-Farm Marketplace</title>
    <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase.js"></script>
    <script src =js/setup_firebase.js></script>
    <script>
        let current = [];
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in.
                var displayName = user.displayName;
                var email = user.email;
                var uid = user.uid;
                current.push(displayName);
                current.push(email);
                current.push(uid);
            } else {
                // User is signed out.
                // ...
            }
        });
    </script>
</head>

<body>
    <!-- Links (sit on top) -->
    <div class="top" style="position: absolute;">
        <div class="row large light-grey">
            <div class="col s3" id="home"><a href="index.html" class="button block">Home</a></div>
            <div class="col s3" id="about"><a href="about.html" class="button block">About</a></div>
            <div class="col s3" id="marketplace"><a href="marketplace.html" class="button block">Marketplace</a></div>
            <div class="col s3" id="farmer"><a href="SellerHub.html" class="button block">Farmers</a></div>
        </div>
    </div>
    
    <div class="sidenav">
        <form>
            <input type="text" name="search" placeholder="ðŸ”Ž">
        </form>
        <!-- <input type="checkbox" name="" value=""><br> -->
        <p class="sideNavHeaders">Options:<p>
        <div>
            <form action="/action_page.php" class="opac">
                <input type="checkbox" name="option" value="RootVeg">Root Vegetables<br>
                <input type="checkbox" name="option" value="Spices">Spices<br>
            </form>
        </div>
        <p class="sideNavHeaders">Price:<p>
        <div>
            <form action="/action_page.php"class="opac">
                <input type="checkbox" name="price" value="high">$$$<br>
                <input type="checkbox" name="price" value="medium">$$<br>
                <input type="checkbox" name="price" value="low">$<br>
            </form>
        </div>
        <p class="sideNavHeaders">Sort by:<p>
        <div>
            <form action="/action_page.php"class="opac">
                <input type="checkbox" name="sortBy" value="Rating">Farmer rating<br>
                <input type="checkbox" name="sortBy" value="Distance">Relative Distance<br>
                <input type="checkbox" name="sortBy" value="Seasonal">Seasonal<br>
                <input type="checkbox" name="sortBy" value="BatchSize">Size of batch<br>
            </form>
        </div>
    <!-- https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_input_checked -->
    <!-- Check box and form tutorial -->
    </div>


    <div class="main">
        <div class="content" style="max-width:1100px;margin: 0px 80px 0px 0px;">
            <!-- Grid -->
            <div class="center" style="margin-bottom: 50px">
                    <h1 id="topheading">Marketplace</h1>
            </div>

            <div class="row-padding">
                <div class="quarter margin-bottom">
                <a href="javascript:void(0)" class="" onclick="document.getElementById('buy1').style.display='block'">
                <ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/2.jpg" id="img1"></li>
                    <li class="padding-16"><b>Product:</b> <span id="pro1"> Apples </span><br>
                                            <b>Farmer:</b> <em id="farm1"> James Garden</em><br>
                                            <b>Rating:</b> <em id="farr1"> 98</em>
                                            <p style = "display:none" id = "FarmerID1"></p></li>
                                            
                </ul></a></div>

                <div class="quarter margin-bottom">
                <a href="javascript:void(0)" class="" onclick="document.getElementById('buy2').style.display='block'">
                <ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/1.jpg" id="img2"></li>
                    <li class="padding-16"><b>Product:</b> <span id="pro2"> Vegetables </span> <br>
                                            <b>Farmer:</b> <em id="farm2"> Brussels Westbrook</em><br>
                                            <b>Rating:</b> <em id="farr2"> 99</em>
                                            <p style = "display:none" id = "FarmerID2"></p></li>
                                            
                </ul></a></div>
            
                <div class="quarter margin-bottom">
                <a href="javascript:void(0)" class="" onclick="document.getElementById('buy3').style.display='block'">
                <ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/1.jpg" id="img3"></li>
                    <li class="padding-16"><b>Product:</b> <span id="pro3"> Veggies </span> <br>
                                            <b>Farmer:</b> <em id="farm3"> B. Cucumberbatch</em><br>
                                            <b>Rating:</b> <em id="farr3"> 93</em>
                                            <p style = "display:none" id = "FarmerID3"></p></li>
                                            
                </ul></a></div>

                <div class="quarter margin-bottom">
                <a href="javascript:void(0)" class="" onclick="document.getElementById('buy4').style.display='block'">
                <ul class="ul border card hover-shadow">
                    <li class=" xlarge"><img src="img/2.jpg" id="img4"></li>
                    <li class="padding-16"><b>Product:</b> <span id="pro4"> Green </span> <br>
                                            <b>Farmer:</b> <em id="farm4"> Dramond Green</em><br>
                                            <b>Rating:</b> <em id="farr4"> 93</em>
                                            <p style = "display:none" id = "FarmerID4"></p></li>
                                            
                </ul></a></div>
            </div>
            <div class="row-padding">
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/3.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Greennn <br><b>Farmer:</b> Jared <br><b>Rating:</b> 19 </li>
                </ul></div>
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/4.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Veggies <br><b>Farmer:</b> Nik <br><b>Rating:</b> 21 </li>
                </ul></div>
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/6.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Cucumber <br><b>Farmer:</b> Rabber <br><b>Rating:</b> 69 </li>
                </ul></div>               
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class=" xlarge"><img src="img/2.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Fruits <br><b>Farmer:</b> Worm <br><b>Rating:</b> 0 </li>
                </ul></div>
            </div>
            <div class="row-padding">
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/6.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Cucumber <br><b>Farmer:</b> Werm <br><b>Rating:</b> 34 </li>
                </ul></div>
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/2.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Dirt <br><b>Farmer:</b> Velma <br><b>Rating:</b> 23 </li>
                </ul></div>
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/5.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Carrots <br><b>Farmer:</b> Scoob <br><b>Rating:</b> 12 </li>
                </ul></div>               
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class=" xlarge"><img src="img/1.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Green stuf <br><b>Farmer:</b> Laila <br><b>Rating:</b> 99 </li>
                </ul></div>
            </div>
            <div class="row-padding">
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/1.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Fruits <br><b>Farmer:</b> Linn <br><b>Rating:</b> 87 </li>
                </ul></div>
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/3.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Carrots <br><b>Farmer:</b> Henry <br><b>Rating:</b> 60 </li>
                </ul></div>
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class="xlarge"><img src="img/2.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Nuts <br><b>Farmer:</b> James <br><b>Rating:</b> 88 </li>
                </ul></div>               
                <div class="quarter margin-bottom"><ul class="ul border card hover-shadow">
                    <li class=" xlarge"><img src="img/3.jpg"></li>
                    <li class="padding-16"><b>Product:</b> Apples <br><b>Farmer:</b> Mike <br><b>Rating:</b> 78 </li>
                </ul></div>
            </div>
            <div class="center"><a href="" class="center"> See more</a></div>
        </div>

	<!-- Buy Modal -->
	<div id="buy1" class="modal">
        <div class="modal-content animate-zoom padding-large">
            <div class="container white left-align">
                <i onclick="document.getElementById('buy1').style.display='none'" class="fa fa-remove button xlarge right transparent"></i>
                <h2 class="wide center">Purchase</h2>
                <img src="img/2.jpg" id="img01">
                <b>Product: </b> <span id="pro01"> Apples </span><br/>
                <b>Description: </b><span id="desc01"></span><br/>
                <b>Farmer: </b> <span id="farm01"> James Garden</span><br/>
                <b>Rating: </b> <span id="farr01"> 98</span></li>
                <p><strong>Quantity</strong><input class="input border" type="number" placeholder="Enter quantity" id="quantity1" required min=1 max=100>
                    <select name="weight" id="weight1" required>
                        <option value="pounds" selected>Pounds</option>
                        <option value="ounces">Ounces</option>
                        <option value="grams">Grams</option>
                        <option value="kilograms">kilograms</option>
                    </select></p>
                <p><strong>Pickup date</strong><input class="input border" type="date" placeholder="" id="pickup1" required></p>
                <p><strong>Pickup Time</strong><input class="input border" type="time" id="pickuptime1"</p>    

                <div class="center">
                    <button type="button" class="button padding-large green margin-bottom" onclick="updateDatabase(1)">Order</button>
                </div>
            </div>
        </div>
    </div>
    <div id="buy2" class="modal">
        <div class="modal-content animate-zoom padding-large">
            <div class="container white left-align">
                <i onclick="document.getElementById('buy2').style.display='none'" class="fa fa-remove button xlarge right transparent"></i>
                <h2 class="wide center">Purchase</h2>
                <img src="img/1.jpg" id="img02">
                <b>Product: </b> <span id="pro02"> Vegetables </span><br/>
                <b>Description: </b><span id="desc02"></span><br/>
                <b>Farmer: </b> <span id="farm02"> Brussels westbrook</span><br/>
                <b>Rating: </b> <span id="farr02"> 99</span></li>
                <p><strong>Quantity</strong><input class="input border" type="number" placeholder="Enter quantity" id="quantity2" required min=1 max=100>
                    <select name="weight" id="weight2" required>
                        <option value="pounds" selected>Pounds</option>
                        <option value="ounces">Ounces</option>
                        <option value="grams">Grams</option>
                        <option value="kilograms">kilograms</option>
                    </select></p>
                <p><strong>Pickup date</strong><input class="input border" type="date" placeholder="" id="pickup2" required></p>
                <p><strong>Pickup Time</strong><input class="input border" type="time" id="pickuptime2"</p>    

                <div class="center">
                    <button type="button" class="button padding-large green margin-bottom" onclick="updateDatabase(2)">Order</button>
                </div>
            </div>
        </div>
    </div>
	<div id="buy3" class="modal">
        <div class="modal-content animate-zoom padding-large">
            <div class="container white left-align">
                <i onclick="document.getElementById('buy3').style.display='none'" class="fa fa-remove button xlarge right transparent"></i>
                <h2 class="wide center">Purchase</h2>
                <img src="img/1.jpg" id="img03">
                <b>Product: </b> <span id="pro03"> Veggies </span><br/>
                <b>Description: </b><span id="desc03"></span><br/>
                <b>Farmer: </b> <span id="farm03"> B. Cucumberbatch</span><br/>
                <b>Rating: </b> <span id="farr03"> 93</span></li>
                <p><strong>Quantity</strong><input class="input border" type="number" placeholder="Enter quantity" id="quantity3" required min=1 max=100>
                    <select name="weight" id="weight3" required>
                        <option value="pounds" selected>Pounds</option>
                        <option value="ounces">Ounces</option>
                        <option value="grams">Grams</option>
                        <option value="kilograms">kilograms</option>
                    </select></p>
                <p><strong>Pickup date</strong><input class="input border" type="date" placeholder="" id="pickup3" required></p>
                <p><strong>Pickup Time</strong><input class="input border" type="time" id="pickuptime3"</p>    

                <div class="center">
                    <button type="button" class="button padding-large green margin-bottom" onclick="updateDatabase(3)">Order</button>
                </div>
            </div>
        </div>
    </div>
	<div id="buy4" class="modal">
        <div class="modal-content animate-zoom padding-large">
            <div class="container white left-align">
                <i onclick="document.getElementById('buy4').style.display='none'" class="fa fa-remove button xlarge right transparent"></i>
                <h2 class="wide center">Purchase</h2>
                <img src="img/2.jpg" id="img04">
                <b>Product: </b> <span id="pro04"> Green </span><br/>
                <b>Description: </b><span id="desc04"></span><br/>
                <b>Farmer: </b> <span id="farm04"> Dramond Green</span><br/>
                <b>Rating: </b> <span id="farr04"> 93</span></li>
                <p><strong>Quantity</strong><input class="input border" type="number" placeholder="Enter quantity" id="quantity4" required min=1 max=100>
                    <select name="weight" id="weight4" required>
                        <option value="pounds" selected>Pounds</option>
                        <option value="ounces">Ounces</option>
                        <option value="grams">Grams</option>
                        <option value="kilograms">kilograms</option>
                    </select></p>
                <p><strong>Pickup date</strong><input class="input border" type="date" placeholder="" id="pickup4" required></p>
                <p><strong>Pickup Time</strong><input class="input border" type="time" id="pickuptime4"</p>    

                <div class="center">
                    <button type="button" class="button padding-large green margin-bottom" onclick="updateDatabase(4)">Order</button>
                </div>
            </div>
        </div>
    </div>
        <footer class="container white center" style="max-width:1100px;margin: 0px 80px 0px 0px;">
            <div class="xlarge section">
                <i class="fa fa-facebook-official hover-text-light-green"></i>
                <i class="fa fa-instagram hover-text-light-green"></i>
                <i class="fa fa-snapchat hover-text-light-green"></i>
                <i class="fa fa-twitter hover-text-light-green"></i>
                <i class="fa fa-linkedin hover-text-light-green"></i>
            </div>
        </footer>
    </div>
    <script>
        var displayName = '2';
        var db = firebase.database().ref().child("Listings");
        db.on(
            "value",
            function(snap){
                dict_of_listings = snap.val();
                all_listings = Object.keys(dict_of_listings);
                all_produce = Object.values(dict_of_listings);
                console.log(all_listings);
                console.log(all_produce);
                for (let i=1; i<all_listings.length;i++) {
                    storageRef = firebase.storage().ref();
                    let ref = 'produce_pics/' + all_listings[i-1] + '/produce.jpg';
                    console.log(ref);
                    imagesRef = storageRef.child(ref);
                    imagesRef.getDownloadURL().then(function(url) {
                        document.getElementById("img" + i).src = url;
                        document.getElementById("img0" + i).src = url;
                    });
                    document.getElementById('pro'+i).innerHTML = all_produce[i-1]['Name'];
                    document.getElementById('farm'+i).innerHTML = all_produce[i-1]['Farmer'];
                    document.getElementById('FarmerID'+i).innerHTML = all_produce[i-1]['FarmerID'];
                    document.getElementById('pro0'+i).innerHTML = all_produce[i-1]['Name'];
                    document.getElementById('farm0'+i).innerHTML = all_produce[i-1]['Farmer'];
                    document.getElementById('desc0'+i).innerHTML = all_produce[i-1]['Description']
                }
            }
        )
        let unique;
        var dbs = firebase.database().ref().child("Orders/UniqueOrders");
        dbs.on(
            "value",
            function(snap){
                unique = snap.val();
            }
        );
        function updateDatabase(number) {
            let key = "Order" + unique;
            let date = document.getElementById('pickup' + number).value;
            firebase.database().ref("Orders/").update({
                [key]: {
                    CustName: current[0],
                    Quantity: document.getElementById('quantity' + number).value + ' ' + document.getElementById('weight' + number).value,
                    Produce: document.getElementById('pro0' + number).innerHTML,
                    Day: date.slice(8, 10),
                    Month: date.slice(5, 7),
                    Year: date.slice(0, 4),
                    UserId: current[2],
                    FarmerID: document.getElementById('FarmerID' + number).innerHTML,
                    Number: unique,
                    Pickup: document.getElementById('pickuptime' + number).value 
                }
            });
            firebase.database().ref("Orders/").update({
                UniqueOrders: unique + 1
            })
        }

    </script>

          
</body>
</html>